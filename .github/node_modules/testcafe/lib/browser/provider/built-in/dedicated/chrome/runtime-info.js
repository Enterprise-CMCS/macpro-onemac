"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const endpoint_utils_1 = require("endpoint-utils");
const config_1 = __importDefault(require("./config"));
const create_temp_profile_1 = __importDefault(require("./create-temp-profile"));
const is_docker_1 = __importDefault(require("is-docker"));
class ChromeRuntimeInfo {
    constructor(configString) {
        this.config = config_1.default(configString);
        this.tempProfileDir = null;
        this.cdpPort = this.config.cdpPort;
        this.inDocker = is_docker_1.default();
    }
    async createTempProfile(proxyHostName, allowMultipleWindows) {
        return await create_temp_profile_1.default(proxyHostName, allowMultipleWindows);
    }
    static async create(proxyHostName, configString, allowMultipleWindows) {
        const runtimeInfo = new this(configString);
        if (!runtimeInfo.config.userProfile)
            runtimeInfo.tempProfileDir = await runtimeInfo.createTempProfile(proxyHostName, allowMultipleWindows);
        if (!runtimeInfo.cdpPort && !runtimeInfo.config.userProfile)
            runtimeInfo.cdpPort = await endpoint_utils_1.getFreePort();
        return runtimeInfo;
    }
}
exports.default = ChromeRuntimeInfo;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnVudGltZS1pbmZvLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vc3JjL2Jyb3dzZXIvcHJvdmlkZXIvYnVpbHQtaW4vZGVkaWNhdGVkL2Nocm9tZS9ydW50aW1lLWluZm8udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxtREFBNkM7QUFDN0Msc0RBQWlDO0FBQ2pDLGdGQUFzRDtBQUN0RCwwREFBaUM7QUFJakMsTUFBcUIsaUJBQWlCO0lBU2xDLFlBQXVCLFlBQW9CO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLEdBQVcsZ0JBQVMsQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUM5QyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksQ0FBQztRQUMzQixJQUFJLENBQUMsT0FBTyxHQUFVLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDO1FBQzFDLElBQUksQ0FBQyxRQUFRLEdBQVMsbUJBQVEsRUFBRSxDQUFDO0lBQ3JDLENBQUM7SUFFUyxLQUFLLENBQUMsaUJBQWlCLENBQUUsYUFBcUIsRUFBRSxvQkFBNkI7UUFDbkYsT0FBTyxNQUFNLDZCQUFpQixDQUFDLGFBQWEsRUFBRSxvQkFBb0IsQ0FBQyxDQUFDO0lBQ3hFLENBQUM7SUFFTSxNQUFNLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBRSxhQUFxQixFQUFFLFlBQW9CLEVBQUUsb0JBQTZCO1FBQ2xHLE1BQU0sV0FBVyxHQUFHLElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRTNDLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLFdBQVc7WUFDL0IsV0FBVyxDQUFDLGNBQWMsR0FBRyxNQUFNLFdBQVcsQ0FBQyxpQkFBaUIsQ0FBQyxhQUFhLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQUUxRyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQyxNQUFNLENBQUMsV0FBVztZQUN2RCxXQUFXLENBQUMsT0FBTyxHQUFHLE1BQU0sNEJBQVcsRUFBRSxDQUFDO1FBRTlDLE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7Q0FDSjtBQS9CRCxvQ0ErQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBnZXRGcmVlUG9ydCB9IGZyb20gJ2VuZHBvaW50LXV0aWxzJztcbmltcG9ydCBnZXRDb25maWcgZnJvbSAnLi9jb25maWcnO1xuaW1wb3J0IGNyZWF0ZVRlbXBQcm9maWxlIGZyb20gJy4vY3JlYXRlLXRlbXAtcHJvZmlsZSc7XG5pbXBvcnQgaXNEb2NrZXIgZnJvbSAnaXMtZG9ja2VyJztcbmltcG9ydCBUZW1wRGlyZWN0b3J5IGZyb20gJy4uLy4uLy4uLy4uLy4uL3V0aWxzL3RlbXAtZGlyZWN0b3J5JztcbmltcG9ydCB7IERpY3Rpb25hcnkgfSBmcm9tICcuLi8uLi8uLi8uLi8uLi9jb25maWd1cmF0aW9uL2ludGVyZmFjZXMnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBDaHJvbWVSdW50aW1lSW5mbyB7XG4gICAgcHVibGljIGNvbmZpZzogYW55O1xuICAgIHB1YmxpYyB0ZW1wUHJvZmlsZURpcjogbnVsbCB8IFRlbXBEaXJlY3Rvcnk7XG4gICAgcHVibGljIGNkcFBvcnQ6IG51bGwgfCBudW1iZXI7XG4gICAgcHVibGljIGluRG9ja2VyOiBib29sZWFuO1xuICAgIHB1YmxpYyBicm93c2VyTmFtZT86IHN0cmluZztcbiAgICBwdWJsaWMgYnJvd3NlcklkPzogc3RyaW5nO1xuICAgIHB1YmxpYyBwcm92aWRlck1ldGhvZHM/OiBEaWN0aW9uYXJ5PEZ1bmN0aW9uPjtcblxuICAgIHByb3RlY3RlZCBjb25zdHJ1Y3RvciAoY29uZmlnU3RyaW5nOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpcy5jb25maWcgICAgICAgICA9IGdldENvbmZpZyhjb25maWdTdHJpbmcpO1xuICAgICAgICB0aGlzLnRlbXBQcm9maWxlRGlyID0gbnVsbDtcbiAgICAgICAgdGhpcy5jZHBQb3J0ICAgICAgICA9IHRoaXMuY29uZmlnLmNkcFBvcnQ7XG4gICAgICAgIHRoaXMuaW5Eb2NrZXIgICAgICAgPSBpc0RvY2tlcigpO1xuICAgIH1cblxuICAgIHByb3RlY3RlZCBhc3luYyBjcmVhdGVUZW1wUHJvZmlsZSAocHJveHlIb3N0TmFtZTogc3RyaW5nLCBhbGxvd011bHRpcGxlV2luZG93czogYm9vbGVhbik6IFByb21pc2U8VGVtcERpcmVjdG9yeT4ge1xuICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlVGVtcFByb2ZpbGUocHJveHlIb3N0TmFtZSwgYWxsb3dNdWx0aXBsZVdpbmRvd3MpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGF0aWMgYXN5bmMgY3JlYXRlIChwcm94eUhvc3ROYW1lOiBzdHJpbmcsIGNvbmZpZ1N0cmluZzogc3RyaW5nLCBhbGxvd011bHRpcGxlV2luZG93czogYm9vbGVhbik6IFByb21pc2U8Q2hyb21lUnVudGltZUluZm8+IHtcbiAgICAgICAgY29uc3QgcnVudGltZUluZm8gPSBuZXcgdGhpcyhjb25maWdTdHJpbmcpO1xuXG4gICAgICAgIGlmICghcnVudGltZUluZm8uY29uZmlnLnVzZXJQcm9maWxlKVxuICAgICAgICAgICAgcnVudGltZUluZm8udGVtcFByb2ZpbGVEaXIgPSBhd2FpdCBydW50aW1lSW5mby5jcmVhdGVUZW1wUHJvZmlsZShwcm94eUhvc3ROYW1lLCBhbGxvd011bHRpcGxlV2luZG93cyk7XG5cbiAgICAgICAgaWYgKCFydW50aW1lSW5mby5jZHBQb3J0ICYmICFydW50aW1lSW5mby5jb25maWcudXNlclByb2ZpbGUpXG4gICAgICAgICAgICBydW50aW1lSW5mby5jZHBQb3J0ID0gYXdhaXQgZ2V0RnJlZVBvcnQoKTtcblxuICAgICAgICByZXR1cm4gcnVudGltZUluZm87XG4gICAgfVxufVxuIl19